<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>ZEUSVPN</title>
  <meta name="theme-color" content="#070A10" />
  <style>
    :root{
      --bg0:#05070B;
      --bg1:#070A10;
      --card:#0B111B;
      --card2:#0A0F18;
      --stroke:rgba(255,255,255,.08);
      --stroke2:rgba(255,255,255,.12);
      --text:#EAF0FF;
      --muted:rgba(234,240,255,.62);
      --muted2:rgba(234,240,255,.42);
      --accent:#2C5BFF;
      --accent2:#00E5FF;
      --ok:#3CFFB2;
      --warn:#FFD36C;
      --danger:#FF5C7A;
      --shadow: 0 18px 60px rgba(0,0,0,.6);
      --radius: 22px;
      --radius2: 16px;
    }

    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;
      font-family:-apple-system,BlinkMacSystemFont,"SF Pro Display","SF Pro Text",Inter,Segoe UI,Roboto,Arial,sans-serif;
      background:
        radial-gradient(1200px 800px at 20% -10%, rgba(44,91,255,.22), transparent 60%),
        radial-gradient(900px 700px at 110% 10%, rgba(0,229,255,.12), transparent 55%),
        radial-gradient(900px 700px at 50% 120%, rgba(44,91,255,.10), transparent 60%),
        linear-gradient(180deg, var(--bg0), var(--bg1));
      color:var(--text);
      -webkit-font-smoothing:antialiased;
      text-rendering:optimizeLegibility;
    }

    /* subtle premium grain */
    body:before{
      content:"";
      position:fixed; inset:0;
      pointer-events:none;
      background-image:url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='220' height='220'%3E%3Cfilter id='n'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='.9' numOctaves='3' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='220' height='220' filter='url(%23n)' opacity='.18'/%3E%3C/svg%3E");
      mix-blend-mode:overlay;
      opacity:.10;
    }

    .app{
      max-width:520px;
      margin:0 auto;
      padding:16px 14px 24px;
    }

    /* iOS-like scene transition */
    .scene{
      position:relative;
      min-height: calc(100vh - 40px);
      overflow:hidden;
    }
    .screen{
      position:absolute; inset:0;
      padding-bottom:92px;
      opacity:0;
      transform:translateX(14px);
      transition: opacity .28s ease, transform .28s ease;
      pointer-events:none;
    }
    .screen.active{
      opacity:1;
      transform:translateX(0);
      pointer-events:auto;
    }
    .screen.exit-left{
      opacity:0;
      transform:translateX(-14px);
      pointer-events:none;
    }

    .topbar{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:12px;
      padding:10px 2px 14px;
    }

    .brand{
      display:flex; align-items:center; gap:10px;
      min-width:0;
    }

    .logoWrap{
      width:46px; height:46px;
      border-radius:14px;
      background:
        radial-gradient(80% 80% at 20% 20%, rgba(44,91,255,.35), transparent 55%),
        radial-gradient(70% 70% at 90% 20%, rgba(0,229,255,.18), transparent 55%),
        linear-gradient(180deg, rgba(255,255,255,.08), rgba(255,255,255,.02));
      border:1px solid var(--stroke);
      box-shadow: 0 10px 40px rgba(0,0,0,.45);
      display:flex; align-items:center; justify-content:center;
      overflow:hidden;
    }
    .logoWrap img{
      width:78%;
      height:auto;
      filter: drop-shadow(0 10px 16px rgba(0,0,0,.45));
    }

    .brandText{min-width:0}
    .brandText .name{
      font-weight:740;
      letter-spacing:.2px;
      font-size:16px;
      line-height:1.1;
      white-space:nowrap;
      overflow:hidden;
      text-overflow:ellipsis;
    }
    .brandText .sub{
      margin-top:4px;
      font-size:12px;
      color:var(--muted);
      letter-spacing:.2px;
      white-space:nowrap;
      overflow:hidden;
      text-overflow:ellipsis;
    }

    .pill{
      padding:8px 10px;
      border-radius:999px;
      border:1px solid var(--stroke);
      background:rgba(255,255,255,.04);
      color:var(--muted);
      font-size:12px;
      display:flex; align-items:center; gap:8px;
      user-select:none;
    }
    .dot{
      width:8px;height:8px;border-radius:99px;
      background:rgba(255,255,255,.18);
      box-shadow:0 0 0 4px rgba(255,255,255,.04);
    }
    .dot.ok{ background: var(--ok); box-shadow:0 0 0 4px rgba(60,255,178,.10);}
    .dot.warn{ background: var(--warn); box-shadow:0 0 0 4px rgba(255,211,108,.10);}

    .card{
      background:
        radial-gradient(120% 120% at 20% -10%, rgba(44,91,255,.18), transparent 55%),
        radial-gradient(100% 120% at 110% 10%, rgba(0,229,255,.10), transparent 58%),
        linear-gradient(180deg, rgba(255,255,255,.06), rgba(255,255,255,.02));
      border:1px solid var(--stroke);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      overflow:hidden;
    }

    .hero{
      padding:16px;
    }
    .heroRow{
      display:flex; gap:12px; align-items:flex-start;
    }
    .userAvatar{
      width:46px;height:46px;border-radius:16px;
      border:1px solid var(--stroke);
      background: linear-gradient(180deg, rgba(255,255,255,.08), rgba(255,255,255,.02));
      overflow:hidden;
      flex:0 0 auto;
      display:flex; align-items:center; justify-content:center;
      color:var(--muted2);
      font-weight:700;
      letter-spacing:.2px;
    }
    .userAvatar img{width:100%;height:100%;object-fit:cover}
    .heroMain{flex:1; min-width:0;}
    .hTitle{
      font-size:18px;
      font-weight:760;
      letter-spacing:.2px;
      margin:2px 0 4px;
    }
    .hMeta{
      display:flex; gap:10px; flex-wrap:wrap;
      color:var(--muted);
      font-size:12px;
      margin-top:6px;
    }
    .tag{
      display:inline-flex; gap:6px; align-items:center;
      padding:6px 10px;
      border-radius:999px;
      border:1px solid var(--stroke);
      background:rgba(0,0,0,.18);
    }
    .tag b{color:var(--text); font-weight:700}

    .divider{
      height:1px;
      background: linear-gradient(90deg, transparent, rgba(255,255,255,.12), transparent);
      margin:12px 0;
    }

    .ctaRow{
      display:flex; gap:10px;
      padding:0 16px 16px;
      align-items:center;
    }

    .btn{
      border:none;
      border-radius: 16px;
      padding:14px 14px;
      font-weight:760;
      letter-spacing:.2px;
      color:var(--text);
      background:
        radial-gradient(120% 120% at 20% 0%, rgba(44,91,255,.55), rgba(44,91,255,.20) 60%, rgba(0,0,0,0) 100%),
        linear-gradient(180deg, rgba(255,255,255,.10), rgba(255,255,255,.02));
      border:1px solid rgba(44,91,255,.40);
      box-shadow: 0 18px 50px rgba(44,91,255,.18);
      flex:1;
      display:inline-flex;
      justify-content:center;
      align-items:center;
      gap:10px;
      cursor:pointer;
      user-select:none;
      transform: translateZ(0);
      transition: transform .12s ease, filter .12s ease;
      -webkit-tap-highlight-color: transparent;
    }
    .btn:active{ transform: scale(.98); }
    .btn.secondary{
      background: rgba(255,255,255,.04);
      border:1px solid var(--stroke);
      box-shadow:none;
      flex:0 0 auto;
      padding:14px 16px;
      color:var(--muted);
      font-weight:720;
    }

    .btnSmall{
      width:100%;
      padding:12px 14px;
      border-radius: 14px;
      border:1px solid var(--stroke);
      background: rgba(255,255,255,.04);
      color:var(--text);
      font-weight:720;
      cursor:pointer;
      transition: transform .12s ease;
      -webkit-tap-highlight-color: transparent;
    }
    .btnSmall:active{transform:scale(.98)}

    .hint{
      font-size:12px;
      color:var(--muted);
      padding:0 16px 16px;
      line-height:1.35;
    }

    /* bottom nav */
    .nav{
      position:fixed;
      left:50%;
      transform:translateX(-50%);
      bottom:14px;
      width:min(520px, calc(100% - 22px));
      padding:10px;
      border-radius: 22px;
      border:1px solid var(--stroke);
      background: rgba(10,14,22,.72);
      backdrop-filter: blur(16px);
      box-shadow: 0 20px 70px rgba(0,0,0,.6);
      display:flex;
      gap:8px;
      z-index:20;
    }
    .nav button{
      flex:1;
      border:none;
      background:transparent;
      color:var(--muted);
      padding:12px 10px;
      border-radius: 16px;
      font-weight:720;
      letter-spacing:.2px;
      cursor:pointer;
      -webkit-tap-highlight-color: transparent;
      transition: background .18s ease, color .18s ease, transform .12s ease;
    }
    .nav button:active{transform:scale(.98)}
    .nav button.active{
      background: rgba(255,255,255,.06);
      border:1px solid var(--stroke);
      color:var(--text);
    }

    /* Instructions */
    .insWrap{ padding: 10px 0 0;}
    .insHeader{ padding: 0 2px 12px; }
    .insHeader h2{ margin:0; font-size:18px; font-weight:760; letter-spacing:.2px; }
    .insHeader p{ margin:6px 0 0; color:var(--muted); font-size:12px; line-height:1.35; }

    .swipe{
      position:relative;
      overflow:hidden;
      border-radius: var(--radius);
      border:1px solid var(--stroke);
      background: rgba(255,255,255,.03);
      box-shadow: var(--shadow);
    }
    .swipeTrack{
      display:flex;
      width:300%;
      transform:translateX(0%);
      transition: transform .25s ease;
    }
    .slide{
      width:100%;
      padding:16px;
    }
    .slide h3{ margin:0 0 8px; font-size:15px; font-weight:760;}
    .step{
      padding:10px 12px;
      border:1px solid var(--stroke);
      border-radius: 16px;
      background: rgba(0,0,0,.18);
      margin:10px 0;
      color: var(--muted);
      font-size:12px;
      line-height:1.35;
    }
    .kbd{
      display:inline-block;
      padding:2px 8px;
      border-radius: 999px;
      border:1px solid var(--stroke);
      background: rgba(255,255,255,.04);
      color: var(--text);
      font-weight:700;
      font-size:12px;
    }
    .swipeDots{
      display:flex;
      justify-content:center;
      gap:8px;
      padding:10px 0 12px;
      background: rgba(0,0,0,.12);
      border-top:1px solid var(--stroke);
    }
    .swipeDots span{
      width:8px;height:8px;border-radius:999px;
      background: rgba(255,255,255,.14);
    }
    .swipeDots span.active{
      background: rgba(44,91,255,.9);
      box-shadow: 0 0 0 4px rgba(44,91,255,.14);
    }
    .swipeBtns{
      display:flex;
      gap:10px;
      padding:12px;
      border-top:1px solid var(--stroke);
      background: rgba(0,0,0,.10);
    }
    .swipeBtns button{
      flex:1;
      border:none;
      border-radius: 16px;
      padding:12px;
      font-weight:740;
      color: var(--text);
      background: rgba(255,255,255,.05);
      border:1px solid var(--stroke);
      cursor:pointer;
      -webkit-tap-highlight-color: transparent;
    }
    .swipeBtns button:active{transform:scale(.98)}

    /* Profile */
    .profileCard{ padding:16px; }
    .row{
      display:flex; justify-content:space-between; align-items:center;
      gap:10px;
      padding:10px 0;
    }
    .row + .row{ border-top:1px solid rgba(255,255,255,.06); }
    .row .l{ color:var(--muted); font-size:12px;}
    .row .r{ color:var(--text); font-weight:720; font-size:13px; text-align:right; }

    /* Modal */
    .backdrop{
      position:fixed;
      inset:0;
      background: rgba(0,0,0,.55);
      backdrop-filter: blur(10px);
      display:none;
      align-items:flex-end;
      justify-content:center;
      z-index:50;
    }
    .backdrop.show{ display:flex; }

    .modal{
      width:min(520px, 100%);
      background:
        radial-gradient(120% 120% at 20% 0%, rgba(44,91,255,.20), transparent 55%),
        linear-gradient(180deg, rgba(14,18,28,.92), rgba(10,12,18,.92));
      border:1px solid var(--stroke);
      border-top-left-radius: 26px;
      border-top-right-radius: 26px;
      box-shadow: 0 -18px 60px rgba(0,0,0,.7);
      overflow:hidden;
      max-height: 86vh;
      display:flex;
      flex-direction:column;
      transform: translateY(18px);
      opacity:0;
      transition: transform .22s ease, opacity .22s ease;
    }
    .backdrop.show .modal{
      transform: translateY(0);
      opacity:1;
    }

    .modalHeader{
      padding:12px 14px;
      display:flex; align-items:center; justify-content:space-between;
      border-bottom:1px solid var(--stroke);
      background: rgba(0,0,0,.12);
    }
    .handle{
      width:44px;height:5px;border-radius:999px;
      background: rgba(255,255,255,.16);
      margin:0 auto 6px;
    }
    .modalHeader .title{
      font-weight:760;
      letter-spacing:.2px;
      font-size:14px;
    }
    .xbtn{
      border:none;
      width:36px;height:36px;
      border-radius: 14px;
      background: rgba(255,255,255,.06);
      border:1px solid var(--stroke);
      color: var(--text);
      font-size:18px;
      cursor:pointer;
      -webkit-tap-highlight-color: transparent;
    }
    .xbtn:active{transform:scale(.98)}
    .modalBody{
      padding:14px;
      overflow:auto;
      -webkit-overflow-scrolling: touch;
    }

    .sectionTitle{
      font-size:12px;
      color:var(--muted);
      letter-spacing:.2px;
      margin:10px 2px 8px;
    }

    .chips{
      display:flex;
      flex-wrap:wrap;
      gap:10px;
    }
    .chip{
      flex: 1 1 calc(50% - 10px);
      min-width: 130px;
      padding:12px 12px;
      border-radius: 16px;
      border:1px solid var(--stroke);
      background: rgba(255,255,255,.04);
      color: var(--text);
      cursor:pointer;
      user-select:none;
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:8px;
      transition: transform .12s ease, border-color .12s ease, background .12s ease;
      -webkit-tap-highlight-color: transparent;
    }
    .chip:active{transform:scale(.98)}
    .chip.active{
      border-color: rgba(44,91,255,.55);
      background:
        radial-gradient(120% 120% at 20% 0%, rgba(44,91,255,.25), rgba(255,255,255,.04));
    }
    .chip .small{ font-size:11px; color: var(--muted); }
    .badge{
      font-size:10px;
      padding:4px 8px;
      border-radius: 999px;
      border:1px solid var(--stroke);
      background: rgba(0,0,0,.14);
      color: var(--muted);
      white-space:nowrap;
    }
    .badge.pop{ color: rgba(255,211,108,.95); border-color: rgba(255,211,108,.22); }
    .badge.best{ color: rgba(60,255,178,.95); border-color: rgba(60,255,178,.22); }

    /* 3D summary card */
    .summary{
      margin-top:14px;
      padding:14px;
      border-radius: 20px;
      border:1px solid rgba(255,255,255,.10);
      background:
        radial-gradient(120% 120% at 20% 0%, rgba(44,91,255,.22), transparent 55%),
        radial-gradient(120% 120% at 110% 10%, rgba(0,229,255,.10), transparent 60%),
        linear-gradient(180deg, rgba(255,255,255,.06), rgba(255,255,255,.02));
      box-shadow: 0 22px 70px rgba(0,0,0,.55);
      transform: perspective(900px) rotateX(8deg);
      position:relative;
      overflow:hidden;
    }
    .summary:before{
      content:"";
      position:absolute;
      inset:-40%;
      background: linear-gradient(120deg, transparent 35%, rgba(255,255,255,.14) 48%, transparent 62%);
      transform: translateX(-60%);
      animation: shimmer 2.8s ease-in-out infinite;
      opacity:.25;
    }
    @keyframes shimmer{
      0%{transform:translateX(-60%)}
      50%{transform:translateX(30%)}
      100%{transform:translateX(110%)}
    }
    .summary *{ position:relative; z-index:1; }
    .summaryTop{
      display:flex; justify-content:space-between; align-items:flex-start;
      gap:10px;
    }
    .summaryTop h4{
      margin:0;
      font-size:14px;
      font-weight:780;
      letter-spacing:.2px;
    }
    .price{
      font-weight:820;
      font-size:16px;
      letter-spacing:.2px;
    }
    .summarySub{
      margin-top:8px;
      color:var(--muted);
      font-size:12px;
      line-height:1.35;
    }

    .modalFooter{
      padding:12px 14px 16px;
      border-top:1px solid var(--stroke);
      background: rgba(0,0,0,.12);
    }

    .row2{
      display:flex;
      gap:10px;
      align-items:center;
    }

    .linkBox{
      margin-top:10px;
      padding:12px;
      border-radius: 16px;
      border:1px solid var(--stroke);
      background: rgba(0,0,0,.16);
      color: var(--text);
      font-size:12px;
      line-height:1.35;
      word-break: break-all;
    }

    .muted{color:var(--muted)}
    .tiny{font-size:11px;color:var(--muted2)}
    .hide{display:none!important}

    /* Nice selection haptic (Telegram only) */
  </style>
</head>
<body>
  <div class="app">
    <div class="topbar">
      <div class="brand">
        <div class="logoWrap">
          <!-- вставь сюда свой логотип -->
          <img id="brandLogo" alt="ZEUSVPN logo" src="logo.png" onerror="this.style.display='none';" />
        </div>
        <div class="brandText">
          <div class="name">ZEUSVPN</div>
          <div class="sub">Премиум-подписка • Быстрый доступ</div>
        </div>
      </div>

      <div class="pill" id="subPill">
        <span class="dot warn" id="subDot"></span>
        <span id="subPillText">Подписка: не активна</span>
      </div>
    </div>

    <div class="scene">
      <!-- HOME -->
      <section class="screen active" id="screen-home">
        <div class="card">
          <div class="hero">
            <div class="heroRow">
              <div class="userAvatar" id="avatarBox">Z</div>
              <div class="heroMain">
                <div class="hTitle" id="helloTitle">ZEUSVPN</div>
                <div class="hMeta">
                  <span class="tag"><span class="muted">TG ID:</span> <b id="tgId">—</b></span>
                  <span class="tag"><span class="muted">Ник:</span> <b id="tgUser">@—</b></span>
                </div>
              </div>
            </div>

            <div class="divider"></div>

            <div class="hMeta" style="margin-top:0">
              <span class="tag"><span class="muted">Статус:</span> <b id="subStatus">Нет подписки</b></span>
              <span class="tag"><span class="muted">Активна до:</span> <b id="activeUntil">—</b></span>
            </div>
          </div>

          <div class="ctaRow">
            <button class="btn" id="buyBtn">
              <span id="buyBtnText">Приобрести подписку</span>
              <span style="opacity:.9">→</span>
            </button>
            <button class="btn secondary" id="copyLastBtn" title="Скопировать последний конфиг">⧉</button>
          </div>

          <div class="hint" id="homeHint">
            Оплата через Stars открывается внутри Telegram WebApp, а в браузере — обычной ссылкой.
            После оплаты конфиг появится автоматически.
          </div>
        </div>

        <div style="height:14px"></div>

        <div class="card" style="padding:16px">
          <div style="display:flex;justify-content:space-between;align-items:center;gap:10px;">
            <div>
              <div style="font-weight:760;letter-spacing:.2px;">Последний конфиг</div>
              <div class="tiny">Появится после успешной оплаты</div>
            </div>
            <span class="badge" id="cfgBadge">—</span>
          </div>
          <div class="linkBox" id="configBox">Нет конфига</div>
          <div style="height:10px"></div>
          <button class="btnSmall" id="copyCfgBtn">Скопировать</button>
        </div>
      </section>

      <!-- INSTRUCTIONS -->
      <section class="screen" id="screen-instructions">
        <div class="insWrap">
          <div class="insHeader">
            <h2>Инструкция</h2>
            <p>Свайпай карточки или листай кнопками. Вставь конфиг в приложение и подключись.</p>
          </div>

          <div class="swipe" id="swipe">
            <div class="swipeTrack" id="swipeTrack">
              <div class="slide">
                <h3>iOS</h3>
                <div class="step">1) Установи клиент: <span class="kbd">V2Box</span> / <span class="kbd">Shadowrocket</span> (если есть).</div>
                <div class="step">2) Нажми <span class="kbd">+</span> → Import from Clipboard / QR.</div>
                <div class="step">3) Вставь конфиг, сохрани, включи подключение.</div>
              </div>
              <div class="slide">
                <h3>Android</h3>
                <div class="step">1) Установи: <span class="kbd">v2rayNG</span>.</div>
                <div class="step">2) Нажми <span class="kbd">+</span> → Import config from Clipboard.</div>
                <div class="step">3) Выбери профиль и нажми старт.</div>
              </div>
              <div class="slide">
                <h3>Desktop</h3>
                <div class="step">1) Установи: <span class="kbd">Nekoray</span> / <span class="kbd">v2rayN</span>.</div>
                <div class="step">2) Import from Clipboard → вставь конфиг.</div>
                <div class="step">3) Включи системный прокси и подключись.</div>
              </div>
            </div>
            <div class="swipeDots">
              <span class="active"></span>
              <span></span>
              <span></span>
            </div>
            <div class="swipeBtns">
              <button id="prevSlide">Назад</button>
              <button id="nextSlide">Далее</button>
            </div>
          </div>
        </div>
      </section>

      <!-- PROFILE -->
      <section class="screen" id="screen-profile">
        <div class="card profileCard">
          <div style="display:flex; align-items:center; gap:12px;">
            <div class="userAvatar" id="avatarBox2">Z</div>
            <div style="min-width:0">
              <div style="font-weight:780;letter-spacing:.2px;">Профиль</div>
              <div class="tiny" id="profileSub">Данные из Telegram, если открыт как Mini App</div>
            </div>
          </div>

          <div class="divider"></div>

          <div class="row">
            <div class="l">TG ID</div>
            <div class="r" id="tgId2">—</div>
          </div>
          <div class="row">
            <div class="l">Ник</div>
            <div class="r" id="tgUser2">@—</div>
          </div>
          <div class="row">
            <div class="l">Имя</div>
            <div class="r" id="tgName2">—</div>
          </div>

          <div style="height:12px"></div>
          <button class="btnSmall" id="clearLocalBtn">Очистить локальные данные</button>
          <div class="tiny" style="margin-top:10px;">
            Это очищает только кэш на устройстве (последний конфиг/заказ).
          </div>
        </div>
      </section>
    </div>
  </div>

  <!-- Bottom nav -->
  <div class="nav">
    <button class="active" id="navHome">Главная</button>
    <button id="navIns">Инструкция</button>
    <button id="navProfile">Профиль</button>
  </div>

  <!-- Purchase modal -->
  <div class="backdrop" id="backdrop">
    <div class="modal" role="dialog" aria-modal="true" aria-label="Покупка подписки">
      <div class="handle"></div>
      <div class="modalHeader">
        <div class="title">Подписка ZEUSVPN</div>
        <button class="xbtn" id="closeModal">×</button>
      </div>

      <div class="modalBody">
        <div class="sectionTitle">Устройства</div>
        <div class="chips" id="devicesChips"></div>

        <div class="sectionTitle" style="margin-top:14px;">Срок</div>
        <div class="chips" id="daysChips"></div>

        <div class="summary" id="summaryCard">
          <div class="summaryTop">
            <div>
              <h4 id="summaryTitle">Выберите параметры</h4>
              <div class="summarySub" id="summarySub">Устройства и срок</div>
            </div>
            <div class="price" id="summaryPrice">—</div>
          </div>
          <div class="summarySub" style="margin-top:10px;">
            После оплаты конфиг появится на главной и его можно будет скопировать.
          </div>
        </div>

        <div class="linkBox hide" id="invoiceBox"></div>
        <div class="linkBox hide" id="paidBox"></div>
      </div>

      <div class="modalFooter">
        <div class="row2">
          <button class="btn" id="payStarsBtn">Оплатить Stars</button>
          <button class="btn secondary" id="openInvoiceBtn">Открыть</button>
        </div>
        <div class="tiny" style="margin-top:10px;">
          CryptoPay позже подключишь — кнопки добавим, когда включишь реальный invoice + webhook.
        </div>
      </div>
    </div>
  </div>

  <script>
    // =========================
    // CONFIG
    // =========================
    const API_BASE = "https://api.45.133.251.210.nip.io:8443";

    // цены (визуально) — сервер всё равно решает amount
    const PRICE = {
      30: 199,
      90: 399,
      180: 599
    };

    const DEVICES = [1,3,5,10];
    const DAYS = [30,90,180];

    // =========================
    // Telegram WebApp helpers
    // =========================
    const tg = window.Telegram && window.Telegram.WebApp ? window.Telegram.WebApp : null;
    function haptic(type="light"){
      try{
        if(tg && tg.HapticFeedback){
          tg.HapticFeedback.impactOccurred(type);
        }
      }catch(e){}
    }
    function openTgLink(url){
      if(tg){
        try{ tg.openLink(url); return; }catch(e){}
      }
      window.open(url, "_blank");
    }

    // =========================
    // State (local)
    // =========================
    const LS = {
      lastConfig: "zeusvpn_last_config",
      lastOrder: "zeusvpn_last_order",
      activeUntil: "zeusvpn_active_until",
      paid: "zeusvpn_paid"
    };

    let state = {
      user_key: "site-user",
      tg_id: null,
      tg_user: null,
      tg_name: null,
      tg_photo: null,

      selectedDevices: 1,
      selectedDays: 30,
      lastOrderId: localStorage.getItem(LS.lastOrder) || null,
      lastConfig: localStorage.getItem(LS.lastConfig) || null,
      activeUntil: localStorage.getItem(LS.activeUntil) || null,
      isPaid: localStorage.getItem(LS.paid) === "1"
    };

    // =========================
    // Elements
    // =========================
    const screens = {
      home: document.getElementById("screen-home"),
      instructions: document.getElementById("screen-instructions"),
      profile: document.getElementById("screen-profile"),
    };
    const navHome = document.getElementById("navHome");
    const navIns = document.getElementById("navIns");
    const navProfile = document.getElementById("navProfile");

    const buyBtn = document.getElementById("buyBtn");
    const buyBtnText = document.getElementById("buyBtnText");

    const configBox = document.getElementById("configBox");
    const cfgBadge = document.getElementById("cfgBadge");
    const copyCfgBtn = document.getElementById("copyCfgBtn");
    const copyLastBtn = document.getElementById("copyLastBtn");

    const subPillText = document.getElementById("subPillText");
    const subDot = document.getElementById("subDot");
    const subStatus = document.getElementById("subStatus");
    const activeUntilEl = document.getElementById("activeUntil");

    const tgIdEl = document.getElementById("tgId");
    const tgUserEl = document.getElementById("tgUser");
    const tgId2 = document.getElementById("tgId2");
    const tgUser2 = document.getElementById("tgUser2");
    const tgName2 = document.getElementById("tgName2");
    const helloTitle = document.getElementById("helloTitle");

    const avatarBox = document.getElementById("avatarBox");
    const avatarBox2 = document.getElementById("avatarBox2");

    const clearLocalBtn = document.getElementById("clearLocalBtn");

    // Modal
    const backdrop = document.getElementById("backdrop");
    const closeModal = document.getElementById("closeModal");
    const devicesChips = document.getElementById("devicesChips");
    const daysChips = document.getElementById("daysChips");
    const summaryTitle = document.getElementById("summaryTitle");
    const summarySub = document.getElementById("summarySub");
    const summaryPrice = document.getElementById("summaryPrice");
    const payStarsBtn = document.getElementById("payStarsBtn");
    const openInvoiceBtn = document.getElementById("openInvoiceBtn");
    const invoiceBox = document.getElementById("invoiceBox");
    const paidBox = document.getElementById("paidBox");

    // Swipe
    const swipeTrack = document.getElementById("swipeTrack");
    const prevSlide = document.getElementById("prevSlide");
    const nextSlide = document.getElementById("nextSlide");
    const dots = Array.from(document.querySelectorAll(".swipeDots span"));
    let slideIndex = 0;

    // =========================
    // UI functions
    // =========================
    function setScreen(name){
      const order = ["home","instructions","profile"];
      for(const k of order){
        const el = screens[k];
        if(k === name){
          el.classList.add("active");
          el.classList.remove("exit-left");
        }else{
          // nice iOS-like fade+slide
          if(el.classList.contains("active")){
            el.classList.remove("active");
            el.classList.add("exit-left");
            setTimeout(()=>el.classList.remove("exit-left"), 280);
          }else{
            el.classList.remove("active");
          }
        }
      }
      navHome.classList.toggle("active", name==="home");
      navIns.classList.toggle("active", name==="instructions");
      navProfile.classList.toggle("active", name==="profile");
    }

    function setAvatar(photoUrl, fallbackLetter="Z"){
      function fill(box){
        box.innerHTML = "";
        if(photoUrl){
          const img = document.createElement("img");
          img.src = photoUrl;
          img.alt = "avatar";
          box.appendChild(img);
        }else{
          box.textContent = fallbackLetter;
        }
      }
      fill(avatarBox); fill(avatarBox2);
    }

    function fmtDate(iso){
      if(!iso) return "—";
      try{
        const d = new Date(iso);
        // dd.mm.yyyy
        const dd = String(d.getDate()).padStart(2,"0");
        const mm = String(d.getMonth()+1).padStart(2,"0");
        const yy = d.getFullYear();
        return `${dd}.${mm}.${yy}`;
      }catch(e){
        return "—";
      }
    }

    function updateSubscriptionUI(){
      const hasActive = !!state.activeUntil && (new Date(state.activeUntil).getTime() > Date.now());
      if(hasActive){
        subPillText.textContent = "Подписка: активна";
        subDot.classList.remove("warn");
        subDot.classList.add("ok");
        subStatus.textContent = "Активна";
        activeUntilEl.textContent = fmtDate(state.activeUntil);
        buyBtnText.textContent = "Продлить";
      }else{
        subPillText.textContent = "Подписка: не активна";
        subDot.classList.remove("ok");
        subDot.classList.add("warn");
        subStatus.textContent = "Нет подписки";
        activeUntilEl.textContent = "—";
        buyBtnText.textContent = "Приобрести подписку";
      }
    }

    function updateConfigUI(){
      if(state.lastConfig){
        configBox.textContent = state.lastConfig;
        cfgBadge.textContent = "готово";
      }else{
        configBox.textContent = "Нет конфига";
        cfgBadge.textContent = "—";
      }
    }

    function updateUserUI(){
      tgIdEl.textContent = state.tg_id || "—";
      tgUserEl.textContent = state.tg_user ? "@"+state.tg_user.replace(/^@/,"") : "@—";
      tgId2.textContent = state.tg_id || "—";
      tgUser2.textContent = state.tg_user ? "@"+state.tg_user.replace(/^@/,"") : "@—";
      tgName2.textContent = state.tg_name || "—";

      helloTitle.textContent = "ZEUSVPN";
      const letter = (state.tg_name && state.tg_name.trim()[0]) ? state.tg_name.trim()[0].toUpperCase() : "Z";
      setAvatar(state.tg_photo, letter);
    }

    function showModal(){
      backdrop.classList.add("show");
      invoiceBox.classList.add("hide");
      paidBox.classList.add("hide");
      openInvoiceBtn.disabled = true;
      openInvoiceBtn.style.opacity = .55;
      haptic("light");
      renderSummary();
    }
    function hideModal(){
      backdrop.classList.remove("show");
      haptic("light");
    }

    function chipEl(label, sub, badgeText){
      const el = document.createElement("div");
      el.className = "chip";
      const left = document.createElement("div");
      left.innerHTML = `<div style="font-weight:760;letter-spacing:.2px">${label}</div><div class="small">${sub}</div>`;
      const right = document.createElement("div");
      if(badgeText){
        right.innerHTML = `<span class="badge ${badgeText==='Популярно'?'pop':(badgeText==='Выгоднее'?'best':'')}">${badgeText}</span>`;
      }else{
        right.innerHTML = `<span class="badge">выбор</span>`;
      }
      el.appendChild(left);
      el.appendChild(right);
      return el;
    }

    function renderChips(){
      devicesChips.innerHTML = "";
      DEVICES.forEach(d=>{
        const el = chipEl(`${d} устройств`, d===1?"Личный доступ":"Для команды / семьи", "");
        el.classList.toggle("active", state.selectedDevices===d);
        el.addEventListener("click", ()=>{
          state.selectedDevices = d;
          haptic("light");
          renderChips();
          renderSummary();
        });
        devicesChips.appendChild(el);
      });

      daysChips.innerHTML = "";
      DAYS.forEach(days=>{
        let badge = "";
        if(days===30) badge = "Популярно";
        if(days===180) badge = "Выгоднее";
        const el = chipEl(`${days} дней`, days===30?"Оптимально начать":(days===90?"Надолго":"Максимальная выгода"), badge);
        el.classList.toggle("active", state.selectedDays===days);
        el.addEventListener("click", ()=>{
          state.selectedDays = days;
          haptic("light");
          renderChips();
          renderSummary();
        });
        daysChips.appendChild(el);
      });
    }

    function renderSummary(){
      const days = state.selectedDays;
      const dev = state.selectedDevices;
      summaryTitle.textContent = `Подписка: ${days} дней`;
      summarySub.textContent = `Устройства: ${dev} • Доступ: сразу после оплаты`;
      summaryPrice.textContent = `${PRICE[days] ?? "—"} ⭐`;
    }

    // =========================
    // API
    // =========================
    async function api(path, opts={}){
      const url = API_BASE + path;
      const res = await fetch(url, {
        ...opts,
        headers: {
          "Content-Type":"application/json",
          ...(opts.headers||{})
        }
      });
      if(!res.ok){
        const t = await res.text().catch(()=> "");
        throw new Error(`HTTP ${res.status}: ${t || res.statusText}`);
      }
      return res.json();
    }

    // Create Stars invoice
    async function createStarsInvoice(){
      const body = {
        user_key: state.user_key,
        days: state.selectedDays,
        devices: state.selectedDevices
      };
      const data = await api("/pay/stars/create", {
        method:"POST",
        body: JSON.stringify(body)
      });
      // { order_id, invoice_link }
      state.lastOrderId = data.order_id;
      localStorage.setItem(LS.lastOrder, state.lastOrderId);

      invoiceBox.classList.remove("hide");
      invoiceBox.textContent = `Invoice: ${data.invoice_link}`;
      openInvoiceBtn.disabled = false;
      openInvoiceBtn.style.opacity = 1;

      openInvoiceBtn.onclick = ()=> openTgLink(data.invoice_link);

      // start polling
      pollOrder(state.lastOrderId);
      return data;
    }

    let pollTimer = null;
    async function pollOrder(orderId){
      if(pollTimer) clearInterval(pollTimer);

      const tick = async ()=>{
        try{
          const data = await api(`/pay/order/${orderId}`, { method:"GET" });

          // active_until on backend
          if(data.active_until){
            state.activeUntil = data.active_until;
            localStorage.setItem(LS.activeUntil, state.activeUntil);
          }

          updateSubscriptionUI();

          if(data.status === "paid" || data.status === "success"){
            localStorage.setItem(LS.paid, "1");
            state.isPaid = true;

            paidBox.classList.remove("hide");
            paidBox.textContent = "Оплата подтверждена ✅";

            // если backend уже записал config_link — покажем
            if(data.config_link){
              state.lastConfig = data.config_link;
              localStorage.setItem(LS.lastConfig, state.lastConfig);
              updateConfigUI();
            }

            // если config_link ещё пустой — просто ждём/или можно вызвать issue-config вручную позже
            clearInterval(pollTimer);
            pollTimer = null;
          }
        }catch(e){
          // молча (сеть может лагать)
        }
      };

      await tick();
      pollTimer = setInterval(tick, 1500);
    }

    async function issueConfigDirect(){
      // если ты хочешь получать конфиг вручную без оплаты — можно оставить,
      // но сейчас у тебя логика "после оплаты" — так что кнопку отдельную не показываем.
      const body = {
        inbound_id: 1,
        user_key: state.user_key,
        days: state.selectedDays,
        limit_ip: 0
      };
      const data = await api("/issue-config", {
        method:"POST",
        body: JSON.stringify(body)
      });
      if(data.link){
        state.lastConfig = data.link;
        localStorage.setItem(LS.lastConfig, state.lastConfig);
        updateConfigUI();
      }
      return data;
    }

    // =========================
    // Copy
    // =========================
    async function copyText(text){
      if(!text) return;
      try{
        await navigator.clipboard.writeText(text);
        haptic("light");
      }catch(e){
        // fallback
        const ta = document.createElement("textarea");
        ta.value = text;
        document.body.appendChild(ta);
        ta.select();
        document.execCommand("copy");
        document.body.removeChild(ta);
      }
    }

    // =========================
    // Swipe logic
    // =========================
    function setSlide(i){
      slideIndex = Math.max(0, Math.min(2, i));
      swipeTrack.style.transform = `translateX(-${slideIndex*100}%)`;
      dots.forEach((d,idx)=> d.classList.toggle("active", idx===slideIndex));
    }
    prevSlide.addEventListener("click", ()=> setSlide(slideIndex-1));
    nextSlide.addEventListener("click", ()=> setSlide(slideIndex+1));

    // =========================
    // Init user (Telegram)
    // =========================
    function initTelegramUser(){
      if(tg){
        try{
          tg.ready();
          const u = tg.initDataUnsafe && tg.initDataUnsafe.user ? tg.initDataUnsafe.user : null;
          if(u){
            state.tg_id = String(u.id);
            state.tg_user = u.username || null;
            state.tg_name = [u.first_name, u.last_name].filter(Boolean).join(" ").trim() || null;
            // В WebApp напрямую фото обычно не приходит, но если есть — используем
            state.tg_photo = u.photo_url || null;

            // user_key = tg_id (идеально для бэка)
            state.user_key = "tg_" + state.tg_id;
          }
        }catch(e){}
      }
      updateUserUI();
    }

    // =========================
    // Handlers
    // =========================
    navHome.onclick = ()=> setScreen("home");
    navIns.onclick = ()=> setScreen("instructions");
    navProfile.onclick = ()=> setScreen("profile");

    buyBtn.onclick = ()=> showModal();
    closeModal.onclick = hideModal;
    backdrop.addEventListener("click",(e)=>{
      if(e.target === backdrop) hideModal();
    });

    payStarsBtn.onclick = async ()=>{
      payStarsBtn.disabled = true;
      payStarsBtn.style.opacity = .75;
      haptic("light");
      try{
        await createStarsInvoice();
      }catch(e){
        alert("Ошибка оплаты: " + e.message);
      }finally{
        payStarsBtn.disabled = false;
        payStarsBtn.style.opacity = 1;
      }
    };

    copyCfgBtn.onclick = ()=> copyText(state.lastConfig || "");
    copyLastBtn.onclick = ()=> copyText(state.lastConfig || "");

    clearLocalBtn.onclick = ()=>{
      localStorage.removeItem(LS.lastConfig);
      localStorage.removeItem(LS.lastOrder);
      localStorage.removeItem(LS.activeUntil);
      localStorage.removeItem(LS.paid);
      state.lastConfig = null;
      state.lastOrderId = null;
      state.activeUntil = null;
      state.isPaid = false;
      updateSubscriptionUI();
      updateConfigUI();
      haptic("light");
    };

    // =========================
    // Boot
    // =========================
    renderChips();
    updateUserUI();
    initTelegramUser();

    updateSubscriptionUI();
    updateConfigUI();

    // если есть orderId — начинаем пуллить, чтобы подтянуть active_until/config_link
    if(state.lastOrderId){
      pollOrder(state.lastOrderId);
    }
  </script>
</body>
</html>
