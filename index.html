<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <title>ZEUSVPN — VLESS конфиг</title>
  <style>
    :root{
      --bg:#ffffff;
      --text:#0b0f1a;
      --sub:#5b6475;
      --card:#f6f7fb;
      --line:rgba(15,23,42,.10);
      --shadow: 0 10px 30px rgba(2,8,23,.10);
      --blue:#007aff;
      --green:#34c759;
      --red:#ff3b30;
      --radius:18px;
      --radius2:24px;
      --mono: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono","Courier New", monospace;
      --sans: -apple-system,BlinkMacSystemFont,"SF Pro Display","SF Pro Text",Segoe UI,Roboto,Helvetica,Arial,sans-serif;
    }

    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;
      font-family:var(--sans);
      background:var(--bg);
      color:var(--text);
      -webkit-font-smoothing:antialiased;
      text-rendering:optimizeLegibility;
    }

    .app{
      max-width: 520px;
      margin: 0 auto;
      padding: 18px 16px 110px;
    }

    /* iOS-like top bar */
    .topbar{
      position: sticky;
      top: 0;
      z-index: 10;
      background: rgba(255,255,255,.85);
      backdrop-filter: blur(18px);
      -webkit-backdrop-filter: blur(18px);
      border-bottom: 1px solid var(--line);
    }
    .topbar-inner{
      max-width:520px;
      margin:0 auto;
      padding: 14px 16px;
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:10px;
    }

    .brand{
      display:flex;
      align-items:center;
      gap:10px;
      min-width:0;
    }
    .logo{
      width:34px;height:34px;border-radius:10px;
      background: radial-gradient(120% 120% at 20% 10%, #ffffff 0%, #eaf1ff 35%, #cfe2ff 70%, #b8d5ff 100%);
      border:1px solid rgba(0,122,255,.22);
      box-shadow: 0 10px 20px rgba(0,122,255,.12);
      display:grid;place-items:center;
      flex:0 0 auto;
      position:relative;
      overflow:hidden;
    }
    .logo:after{
      content:"";
      position:absolute; inset:-40%;
      background: conic-gradient(from 180deg, rgba(0,122,255,.0), rgba(0,122,255,.25), rgba(0,122,255,.0));
      animation: spin 3.4s linear infinite;
    }
    @keyframes spin{to{transform:rotate(360deg)}}
    .logo span{
      position:relative;
      z-index:1;
      font-weight:800;
      color: var(--blue);
      font-size:16px;
      letter-spacing:.5px;
    }
    .brand h1{
      margin:0;
      font-size:16px;
      font-weight:800;
      letter-spacing:-.2px;
      line-height:1.1;
      white-space:nowrap;
      overflow:hidden;
      text-overflow:ellipsis;
    }
    .brand p{
      margin:2px 0 0;
      font-size:12px;
      color:var(--sub);
      white-space:nowrap;
      overflow:hidden;
      text-overflow:ellipsis;
    }

    .pill{
      padding:8px 10px;
      border-radius: 999px;
      background: #f3f6ff;
      border: 1px solid rgba(0,122,255,.18);
      color: var(--blue);
      font-size:12px;
      font-weight:700;
      display:flex;
      gap:8px;
      align-items:center;
      flex:0 0 auto;
    }
    .dot{
      width:8px;height:8px;border-radius:999px;background:var(--green);
      box-shadow: 0 0 0 3px rgba(52,199,89,.18);
    }

    /* hero */
    .hero{
      padding: 18px 2px 6px;
    }
    .hero-title{
      margin: 10px 0 6px;
      font-size: 26px;
      font-weight: 900;
      letter-spacing: -.6px;
      line-height:1.1;
    }
    .hero-sub{
      margin:0 0 14px;
      color:var(--sub);
      font-size:14px;
      line-height:1.45;
    }

    .card{
      background: var(--card);
      border: 1px solid var(--line);
      border-radius: var(--radius2);
      box-shadow: var(--shadow);
    }

    /* selector */
    .selectors{
      padding: 14px;
      display:grid;
      gap: 12px;
    }
    .row{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:12px;
    }
    .label{
      font-size:13px;
      color:var(--sub);
      font-weight:700;
    }

    .seg{
      display:flex;
      gap:6px;
      background: rgba(255,255,255,.75);
      border:1px solid var(--line);
      border-radius: 14px;
      padding: 6px;
      width: 100%;
    }
    .seg button{
      appearance:none;
      border:0;
      background:transparent;
      padding: 10px 10px;
      border-radius: 12px;
      font-weight:800;
      font-size:13px;
      color: var(--sub);
      flex:1;
      cursor:pointer;
      transition: .15s ease;
    }
    .seg button.active{
      background:#ffffff;
      color: var(--text);
      box-shadow: 0 8px 18px rgba(2,8,23,.10);
      border: 1px solid rgba(2,8,23,.06);
    }

    /* plans */
    .plans{
      margin-top: 14px;
      display:grid;
      gap: 12px;
    }
    .plan{
      padding: 14px;
      border-radius: var(--radius2);
      background:#fff;
      border:1px solid var(--line);
      box-shadow: 0 10px 22px rgba(2,8,23,.08);
      display:grid;
      gap: 10px;
      cursor:pointer;
      transition:.15s ease;
    }
    .plan:hover{ transform: translateY(-1px); }
    .plan.active{
      border-color: rgba(0,122,255,.35);
      box-shadow: 0 14px 28px rgba(0,122,255,.16);
    }

    .plan-top{
      display:flex;
      align-items:flex-start;
      justify-content:space-between;
      gap:12px;
    }
    .plan-name{
      margin:0;
      font-weight:900;
      letter-spacing:-.2px;
      font-size:16px;
    }
    .plan-desc{
      margin:4px 0 0;
      color:var(--sub);
      font-size:12px;
      line-height:1.3;
    }
    .price{
      text-align:right;
      font-weight:900;
      font-size:18px;
      letter-spacing:-.2px;
    }
    .price small{
      display:block;
      font-size:11px;
      color:var(--sub);
      font-weight:700;
      margin-top:2px;
    }
    .chips{display:flex; flex-wrap:wrap; gap:8px;}
    .chip{
      font-size:12px;
      font-weight:800;
      padding: 8px 10px;
      border-radius: 999px;
      border:1px solid var(--line);
      background: rgba(246,247,251,.8);
      color: #22304a;
    }

    /* bottom bar */
    .bottombar{
      position: fixed;
      left:0; right:0; bottom:0;
      background: rgba(255,255,255,.85);
      backdrop-filter: blur(18px);
      -webkit-backdrop-filter: blur(18px);
      border-top: 1px solid var(--line);
      padding: 10px 0 calc(10px + env(safe-area-inset-bottom));
      z-index:20;
    }
    .bottombar-inner{
      max-width: 520px;
      margin: 0 auto;
      padding: 0 16px;
      display:flex;
      gap: 10px;
      align-items:center;
    }
    .btn{
      border:0;
      border-radius: 16px;
      padding: 14px 14px;
      font-weight:900;
      cursor:pointer;
      font-size:14px;
      transition:.15s ease;
      display:flex;
      align-items:center;
      justify-content:center;
      gap:10px;
      user-select:none;
      -webkit-tap-highlight-color: transparent;
    }
    .btn.primary{
      background: var(--blue);
      color:#fff;
      box-shadow: 0 14px 26px rgba(0,122,255,.25);
      flex: 1;
    }
    .btn.primary:disabled{
      opacity:.45;
      cursor:not-allowed;
      box-shadow:none;
    }
    .btn.ghost{
      background: #f1f4fb;
      border:1px solid var(--line);
      color: #22304a;
      flex: 0 0 auto;
      padding: 14px 16px;
    }
    .hint{
      margin: 10px 2px 0;
      font-size:12px;
      color: var(--sub);
      line-height:1.45;
    }

    /* modal */
    .modal{
      position: fixed;
      inset:0;
      background: rgba(2,8,23,.45);
      display:none;
      align-items:flex-end;
      justify-content:center;
      z-index:50;
      padding: 14px;
    }
    .modal.show{ display:flex; }
    .sheet{
      width: min(520px, 100%);
      border-radius: 26px;
      overflow:hidden;
      background: #fff;
      border:1px solid rgba(255,255,255,.28);
      box-shadow: 0 30px 80px rgba(2,8,23,.35);
      animation: up .18s ease;
    }
    @keyframes up{
      from{ transform: translateY(20px); opacity:.8;}
      to{ transform: translateY(0); opacity:1;}
    }
    .sheet-head{
      padding: 14px 14px 10px;
      border-bottom:1px solid var(--line);
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap: 10px;
    }
    .sheet-title{
      margin:0;
      font-size:16px;
      font-weight:900;
      letter-spacing:-.2px;
    }
    .xbtn{
      border:0;
      background:#f1f4fb;
      border:1px solid var(--line);
      width: 40px; height: 40px;
      border-radius: 14px;
      cursor:pointer;
      font-size:18px;
      font-weight:900;
    }
    .sheet-body{
      padding: 14px;
      display:grid;
      gap: 12px;
    }
    .mono{
      font-family: var(--mono);
      font-size: 12px;
      line-height: 1.4;
      white-space: pre-wrap;
      word-break: break-all;
      background: #0b0f1a;
      color: #e9efff;
      border-radius: 18px;
      padding: 12px;
      border: 1px solid rgba(255,255,255,.08);
    }
    .row2{
      display:flex;
      gap:10px;
      align-items:center;
    }
    .toast{
      position: fixed;
      left: 50%;
      transform: translateX(-50%);
      bottom: 90px;
      background:#0b0f1a;
      color:#fff;
      padding: 10px 12px;
      border-radius: 14px;
      font-size:12px;
      font-weight:800;
      box-shadow: 0 18px 50px rgba(2,8,23,.35);
      display:none;
      z-index:60;
    }
    .toast.show{display:block}

    .status{
      font-size:12px;
      color: var(--sub);
      font-weight:800;
    }
    .error{ color: var(--red); }
    .ok{ color: var(--green); }

    .divider{
      height:1px;background:var(--line); margin: 2px 0;
    }
  </style>
</head>
<body>
  <div class="topbar">
    <div class="topbar-inner">
      <div class="brand">
        <div class="logo"><span>Z</span></div>
        <div style="min-width:0">
          <h1>ZEUSVPN</h1>
          <p>Website выдачи VLESS-конфигов</p>
        </div>
      </div>
      <div class="pill"><span class="dot"></span><span>Online</span></div>
    </div>
  </div>

  <main class="app">
    <section class="hero">
      <h2 class="hero-title">Выбери тариф — получи рабочий VLESS</h2>
      <p class="hero-sub">
        Конфиг <b>не генерится “рандомным текстом”</b> — бекенд создаёт клиента в <b>3X-UI → Xray</b>,
        поэтому ссылка реально рабочая.
      </p>

      <div class="card selectors">
        <div class="row">
          <div class="label">Срок подписки</div>
          <div class="status" id="subLabel">30 дней</div>
        </div>
        <div class="seg" id="durSeg">
          <button data-days="30" class="active">30</button>
          <button data-days="90">90</button>
          <button data-days="180">180</button>
        </div>

        <div class="divider"></div>

        <div class="row">
          <div class="label">Устройства</div>
          <div class="status" id="devLabel">1 устройство</div>
        </div>
        <div class="seg" id="devSeg">
          <button data-dev="1" class="active">1</button>
          <button data-dev="5">5</button>
          <button data-dev="10">10</button>
        </div>

        <p class="hint">
          После оплаты (или в тестовом режиме) ты получишь VLESS-ссылку. Её можно вставить в <b>V2Box</b> / <b>v2rayNG</b>.
        </p>
      </div>

      <div class="plans" id="plans"></div>
    </section>
  </main>

  <div class="bottombar">
    <div class="bottombar-inner">
      <button class="btn ghost" id="btnTest">Тест</button>
      <button class="btn primary" id="btnBuy" disabled>Получить конфиг</button>
    </div>
  </div>

  <div class="modal" id="modal">
    <div class="sheet">
      <div class="sheet-head">
        <h3 class="sheet-title">Твой VLESS конфиг</h3>
        <button class="xbtn" id="closeModal">×</button>
      </div>
      <div class="sheet-body">
        <div class="status" id="modalStatus">Готово</div>
        <div class="mono" id="vlessBox">vless://...</div>
        <div class="row2">
          <button class="btn primary" id="copyBtn" style="flex:1">Скопировать</button>
          <button class="btn ghost" id="againBtn">Ещё раз</button>
        </div>
        <p class="hint" style="margin:0">
          Вставь ссылку в V2Box / v2rayNG → импорт → подключиться.
        </p>
      </div>
    </div>
  </div>

  <div class="toast" id="toast">Скопировано</div>

<script>
  // === CONFIG ===
  // Поставь URL своего бекенда:
  // - если фронт и бекенд на одном домене: оставь ""
  // - если отдельно: например "https://zeusvpn.example.com"
  const API_BASE = "";

  // === STATE ===
  const state = {
    days: 30,
    devices: 1,
    planId: null,
    plans: [
      { id: "basic", name: "Basic",  desc: "Для личного использования", priceByDays: {30:199, 90:549, 180:999}, tags:["VLESS","1 конфиг","Быстрый старт"] },
      { id: "family", name: "Family", desc: "Для семьи / пары",         priceByDays: {30:399, 90:1099, 180:1999}, tags:["До 5 устройств","VLESS","Стабильность"] },
      { id: "team",  name: "Team",   desc: "Максимальная выгода",      priceByDays: {30:599, 90:1599, 180:2999}, tags:["До 10 устройств","VLESS","Лучшая цена"] },
    ]
  };

  const $ = (id)=>document.getElementById(id);

  function renderPlans(){
    const wrap = $("plans");
    wrap.innerHTML = "";
    state.plans.forEach(p=>{
      const price = p.priceByDays[state.days] ?? p.priceByDays[30];
      const el = document.createElement("div");
      el.className = "plan" + (state.planId===p.id ? " active":"");
      el.innerHTML = `
        <div class="plan-top">
          <div>
            <div class="plan-name">${p.name}</div>
            <div class="plan-desc">${p.desc}</div>
          </div>
          <div class="price">${price}₽<small>за ${state.days} дней</small></div>
        </div>
        <div class="chips">
          ${p.tags.map(t=>`<span class="chip">${t}</span>`).join("")}
        </div>
      `;
      el.addEventListener("click", ()=>{
        state.planId = p.id;
        renderPlans();
        updateBuyButton();
      });
      wrap.appendChild(el);
    });
  }

  function updateLabels(){
    $("subLabel").textContent = `${state.days} дней`;
    $("devLabel").textContent = `${state.devices} ${state.devices===1 ? "устройство" : "устройств"}`;
  }

  function setSegActive(containerId, key, value){
    const seg = $(containerId);
    [...seg.querySelectorAll("button")].forEach(b=>{
      b.classList.toggle("active", Number(b.dataset[key])===Number(value));
    });
  }

  function updateBuyButton(){
    $("btnBuy").disabled = !state.planId;
  }

  function toast(text){
    const t = $("toast");
    t.textContent = text;
    t.classList.add("show");
    setTimeout(()=>t.classList.remove("show"), 1100);
  }

  function openModal(vless, ok=true, msg="Готово"){
    $("modalStatus").textContent = msg;
    $("modalStatus").className = "status " + (ok ? "ok":"error");
    $("vlessBox").textContent = vless || "—";
    $("modal").classList.add("show");
  }
  function closeModal(){ $("modal").classList.remove("show"); }

  async function createOrder(testMode=false){
    const user_key = localStorage.getItem("zeus_user_key") || crypto.randomUUID();
    localStorage.setItem("zeus_user_key", user_key);

    const payload = {
      user_key,
      plan_id: state.planId || "basic",
      days: state.days,
      devices: state.devices,
      test_mode: !!testMode
    };

    $("btnBuy").textContent = "Получаем...";
    $("btnBuy").disabled = true;

    try{
      const res = await fetch(`${API_BASE}/api/order`, {
        method:"POST",
        headers: {"Content-Type":"application/json"},
        body: JSON.stringify(payload)
      });
      const data = await res.json();
      if(!res.ok) throw new Error(data?.detail || "Ошибка API");

      openModal(data.vless, true, "Готово");
    }catch(e){
      openModal(String(e?.message || e), false, "Ошибка");
    }finally{
      $("btnBuy").textContent = "Получить конфиг";
      updateBuyButton();
    }
  }

  // Segments
  $("durSeg").addEventListener("click", (e)=>{
    const b = e.target.closest("button"); if(!b) return;
    state.days = Number(b.dataset.days);
    setSegActive("durSeg","days",state.days);
    updateLabels();
    renderPlans();
  });

  $("devSeg").addEventListener("click", (e)=>{
    const b = e.target.closest("button"); if(!b) return;
    state.devices = Number(b.dataset.dev);
    setSegActive("devSeg","dev",state.devices);
    updateLabels();
  });

  // Buttons
  $("btnBuy").addEventListener("click", ()=>createOrder(false));
  $("btnTest").addEventListener("click", ()=>{
    // Тестовый режим: бекенд может выдавать конфиг без оплаты (или через мок).
    if(!state.planId) state.planId = "basic";
    renderPlans(); updateBuyButton();
    createOrder(true);
  });

  $("closeModal").addEventListener("click", closeModal);
  $("modal").addEventListener("click", (e)=>{ if(e.target.id==="modal") closeModal(); });
  $("copyBtn").addEventListener("click", async ()=>{
    try{
      await navigator.clipboard.writeText($("vlessBox").textContent);
      toast("Скопировано");
    }catch{
      toast("Не удалось скопировать");
    }
  });
  $("againBtn").addEventListener("click", ()=>createOrder(true));

  // Init
  updateLabels();
  renderPlans();
  updateBuyButton();
</script>
</body>
</html>
